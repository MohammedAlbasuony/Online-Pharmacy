@using Pharmacy.BLL.ViewModels
@model OrderViewModel

@{
    ViewData["Title"] = "Order Confirmation";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<!-- Modern Style -->
<style>
    .order-confirmation-container {
        background: linear-gradient(135deg, #f4f7fb, #e0eff8);
        border-radius: 20px;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        padding: 3rem;
    }

    .order-title {
        font-size: 2.8rem;
        font-weight: 700;
        color: #28a745;
        margin-bottom: 2rem;
    }

    .alert {
        padding: 1rem 1.5rem;
        font-size: 1.1rem;
        border-radius: 10px;
    }

    .card-header {
        background-color: #007bff;
        color: #fff;
        font-size: 1.4rem;
        font-weight: 600;
        border-radius: 12px 12px 0 0;
    }

    .badge {
        font-size: 1rem;
        font-weight: 600;
        border-radius: 20px;
    }

        .badge.bg-success {
            background-color: #28a745;
        }

        .badge.bg-warning {
            background-color: #ffc107;
        }

        .badge.bg-danger {
            background-color: #dc3545;
        }

        .badge.bg-secondary {
            background-color: #6c757d;
        }

    .table th, .table td {
        padding: 1rem;
        text-align: center;
        font-size: 1.2rem;
    }

    .table thead {
        background-color: #f8f9fa;
    }

    .table tbody tr {
        background-color: #ffffff;
        border-bottom: 1px solid #e6e6e6;
    }

        .table tbody tr:hover {
            background-color: #f1f3f5;
        }

    .table img {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 50%;
    }

    .button-container {
        margin-top: 3rem;
        display: flex;
        justify-content: center;
        gap: 1.5rem;
    }

    .btn {
        font-size: 1.1rem;
        padding: 1rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        transition: transform 0.3s ease, background-color 0.3s ease;
    }

        .btn:hover {
            transform: translateY(-3px);
        }

    .btn-outline-primary {
        border: 2px solid #007bff;
        color: #007bff;
        background-color: transparent;
    }

        .btn-outline-primary:hover {
            background-color: #007bff;
            color: white;
        }

    .btn-success {
        background-color: #28a745;
        color: white;
        border: none;
    }

        .btn-success:hover {
            background-color: #218838;
        }
</style>

<div class="container order-confirmation-container">
    <div class="text-center mb-4">
        <h2 class="order-title">
            <i class="bi bi-check-circle-fill"></i> Order Confirmation
        </h2>

        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success mt-3">
                @TempData["Success"]
            </div>
        }
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-receipt"></i> Order Summary</h5>
        </div>
        <div class="card-body">
            <p><strong>Order ID:</strong> @Model.Order.OrderID</p>
            <p><strong>Order Date:</strong> @Model.Order.OrderDate.ToString("f")</p>
            <p><strong>Total Price:</strong> @Model.Order.TotalPrice.ToString("C")</p>
            <p>
                <strong>Status:</strong>
                @{
                    var status = Model.Order.Status?.ToLower();
                    string badgeClass = status switch
                    {
                        "paid" => "bg-success",
                        "pending" => "bg-warning text-dark",
                        "cancelled" => "bg-danger",
                        _ => "bg-secondary"
                    };

                    string statusIcon = status switch
                    {
                        "paid" => "bi bi-check-circle-fill",
                        "pending" => "bi bi-hourglass-split",
                        "cancelled" => "bi bi-x-circle-fill",
                        _ => "bi bi-question-circle-fill"
                    };
                }
                <span class="badge @badgeClass text-uppercase px-3 py-2 rounded-pill shadow-sm d-inline-flex align-items-center gap-2">
                    <i class="@statusIcon"></i> @Model.Order.Status
                </span>
            </p>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="bi bi-bag-fill"></i> Ordered Items</h5>
        </div>
        <div class="card-body p-0">
            <table class="table table-hover m-0">
                <thead class="table-secondary">
                    <tr>
                        <th>Medication</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Total Price</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.OrderItems)
                    {
                        <tr>
                            <td>@item.MedicationName</td>
                            <td>@item.Quantity</td>
                            <td>@item.UnitPrice.ToString("C")</td>
                            <td>@(item.Quantity * item.UnitPrice)</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <div class="button-container">
        <a href="@Url.Action("Index", "Cart")" class="btn btn-outline-primary">
            <i class="bi bi-arrow-left-circle"></i> Back to Cart
        </a>

        @if (!string.Equals(Model.Order.Status, "Paid", StringComparison.OrdinalIgnoreCase))
        {
            <form method="post" action="@Url.Action("ConfirmAndPay", "Cart")">
                <input type="hidden" name="orderId" value="@Model.Order.OrderID" />
                <button type="submit" class="btn btn-success">
                    <i class="bi bi-credit-card-fill"></i> Confirm and Pay
                </button>
            </form>
        }
    </div>
</div>
